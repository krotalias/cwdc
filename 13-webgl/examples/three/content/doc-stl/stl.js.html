<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: stl.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: stl.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @file
 *
 * Summary.
 *
 * &lt;p>STL, OBJ, VTK and GLTF Viewer.&lt;/p>
 *
 * &lt;p>&lt;b>For educational purposes only.&lt;/b>&lt;/p>
 *
 * &lt;p>Uses {@link THREE Three.js} to load, display, and manipulate a model read from a
 * {@link https://threejs.org/examples/ file}.
 * The center of the model {@link https://threejs.org/docs/#api/en/math/Box3 bounding box}
 * is translated to the origin so an &lt;a href="/cwdc/13-webgl/extras/doc/ArcBallPresentation.pdf">arcball like&lt;/a>
 * controller can rotate the model.
 * The app interface was designed for mobile devices,
 * and the whole (vastly commented) code is only about a thousand lines of
 * {@link http://vanilla-js.com Vanilla JS} code.&lt;p>
 * I am not a designer, and none of the models used here were made by me.
 * The sources of the &lt;a href="/cwdc/13-webgl/examples/three/content/models">models&lt;/a>
 * are in the links below, and I would like to thank their authors.
 * &lt;p>Four file formats are currently supported:&lt;/p>
 * &lt;ol>
 * &lt;li>{@link https://en.wikipedia.org/wiki/STL_(file_format) STL}
 * is a file format commonly used for 3D printing and computer-aided design (CAD).
 * The name STL is an acronym that stands for stereolithography — a popular 3D printing technology.
 * You might also hear it referred to as Standard Triangle Language or Standard Tessellation Language.&lt;/li>
 *
 * &lt;p>STL does not support an indexed geometry. That is why it has multiple
 * duplicate vertices on all triangles ({@link https://www.geeksforgeeks.org/polygon-mesh-in-computer-graphics/ explicit representation}),
 * and each vertex borrows its normal from the triangle it belongs to.
 * As a consequence, at the same position,
 * there are multiple normal vectors. This leads to a non-smooth surface
 * when using the normal attribute for lighting calculation.
 * Therefore, some {@link loadModel magical} code is necessary to
 * &lt;a href="/cwdc/13-webgl/examples/three/content/stl.html?file=Skull.stl">smooth&lt;/a>
 * the model by
 * applying {@link https://threejs.org/docs/#examples/en/utils/BufferGeometryUtils.mergeVertices mergeVertices}
 * to its {@link https://threejs.org/docs/#api/en/core/BufferGeometry BufferGeometry}
 * followed by a
 * {@link https://threejs.org/docs/#api/en/core/BufferGeometry.computeVertexNormals recalculation}
 * of their normals.&lt;p>
 *
 * &lt;li>{@link https://en.wikipedia.org/wiki/Wavefront_.obj_file OBJ}
 * (or .OBJ) is a geometry definition file format first developed by Wavefront Technologies
 * for its Advanced Visualizer animation package.
 * The file format is open and has been adopted by other 3D graphics application vendors.
 * &lt;p>{@link THREE.MTLLoader MTL file}, short for Material Template Library, is companion file format used in 3D computer graphics and modeling.
 * It is often associated with Wavefront OBJ file format,
 * which is common format for storing 3D models and their associated materials and textures.&lt;/p>
 * &lt;/li>
 *
 * &lt;li>{@link https://docs.vtk.org/en/latest/design_documents/VTKFileFormats.html VTK}
 * provides a number of source and writer objects to read and write popular data file formats.
 * The Visualization Toolkit also provides some of its own file formats.
 * &lt;p>The main reason for creating yet another data file format is to offer a consistent data representation scheme
 * for a variety of dataset types, and to provide a simple method to communicate data between software.&lt;/p>
 * &lt;/li>
 *
 * &lt;li>{@link https://en.wikipedia.org/wiki/GlTF GLTF}
 * glTF (Graphics Library Transmission Format or GL Transmission Format and formerly known as WebGL Transmissions Format or WebGL TF)
 * is a standard file format for three-dimensional scenes and models.
 * A glTF file uses one of two possible file extensions: .gltf (JSON/ASCII) or .glb (binary).
 * Both .gltf and .glb files may reference external binary and texture resources.&lt;/li>
 *
 * &lt;/ol>
 *
 * &lt;b>Notes&lt;/b>:
 * &lt;ul>
 * &lt;li>I strongly recommend using texture sizes of at most 4k (4096 bytes) for mobile devices.&lt;br>
 * There is an excellent {@link https://gltf-transform.dev/ tool}
 * for resizing all textures at once:
 * &lt;pre>
 *    # Resize textures.
 *    gltf-transform resize input.glb output.glb --width 1024 --height 1024
 * &lt;/pre>
 * &lt;li>Zoom and Pan when using an {@link THREE.ArcballControls ArcballControls}
 * on a mobile device only work by calling
 * {@link https://threejs.org/docs/#examples/en/controls/ArcballControls.setCamera setCamera()}
 * every time the camera position changes.
 * As a matter of fact, Three.js has some nasty idiosyncrasies,
 * such as ignoring the &lt;a href="../models/obj/ninja/ninjaHead_Low.mtl">disp&lt;/a>
 * (displacement map)
 * &lt;a href="/cwdc/13-webgl/examples/three/content/stl.html?controls=trackball&amp;file=ninja/ninjaHead_Low.obj">directive&lt;/a>
 * in {@link https://paulbourke.net/dataformats/mtl/ MTL}
 * files and having distinct APIs for the three types of controls supported.&lt;/li>
 * &lt;/li>
 * &lt;li>
 * {@link https://www.youtube.com/watch?v=ShVKVn7p_4Q Visual Effects} and
 * {@link https://lowepost.com/courses/insider/finishing_and_vfx/introduction-to-visual-effects-in-after-effects-r48/ Finishing} is everything.
 * Therefore, I created a few cool environment maps for some
 * &lt;a href="/cwdc/13-webgl/examples/three/content/stl.html?controls=trackball&amp;file=uss_enterprise_ncc-1701.glb">models&lt;/a>.
 * &lt;ul>
 * &lt;li>{@link https://cseweb.ucsd.edu/classes/wi18/cse167-a/lec13.pdf Environment Mapping}&lt;/li>
 * &lt;li>{@link https://developer.download.nvidia.com/CgTutorial/cg_tutorial_chapter07.html nvidia Developer Zone}&lt;/li>
 * &lt;li>{@link https://www.youtube.com/watch?v=PeAvKApuAuA Cem Yuksel}&lt;/li>
 * &lt;li style="list-style-type:none;">&lt;img src="../Spitifire.png" width="256">
 * &lt;/ul>
 * &lt;/li>
 * &lt;li>
 * There is a &lt;a href="../models/models.json">JSON&lt;/a> file for loading models hosted somewhere else.
 * Unless a {@link https://portswigger.net/web-security/cors CORS}-related issue denials the access,
 * the loaders are able to bring all referenced files.
 * &lt;/li>
 * &lt;li>
 * This script has been tested on:
 * &lt;ul>
 * &lt;li>iPhone 6E, &lt;/li>
 * &lt;li>iPhone 7+, &lt;/li>
 * &lt;li>iPhone 8, &lt;/li>
 * &lt;li>iPhone 11, &lt;/li>
 * &lt;li>iPhone 13, &lt;/li>
 * &lt;li>iPad mini 5, &lt;/li>
 * &lt;li>Windows 11, &lt;/li>
 * &lt;li>macOS Catalina/Monterey, &lt;/li>
 * &lt;li>and Ubuntu 22.04, &lt;/li>
 * &lt;/ul>
 * running Safari, Firefox, Chrome and Edge.
 * &lt;/li>
 * &lt;li>
 * All mobile devices have a very limited amount of resources, such as texture memory.&lt;br>
 * In this case, the application may crash and restart by itself, depending on the hardware capabilities.
 * &lt;/li>
 * &lt;li>
 * For hiding a browser's toolbar on iOS, just touch the &lt;small>A&lt;/small>A symbol
 * on the left of the address bar, and select the option: "Hide Toolbar".
 * &lt;/li>
 * &lt;/uL
 *
 * @author Paulo Roma Cavalcanti
 * @since 18/07/24
 * @license Licensed under the {@link https://www.opensource.org/licenses/mit-license.php MIT license}.
 * @copyright © 2024 Paulo R Cavalcanti.
 * @see &lt;a href="/cwdc/13-webgl/examples/three/content/stl.html?controls=arcball&amp;file=cerberus/Cerberus.obj">link (ArcballControls)&lt;/a>
 * @see &lt;a href="/cwdc/13-webgl/examples/three/content/stl.html?controls=orbit&amp;file=Heart/model.glb">link (OrbitControls)&lt;/a>
 * @see &lt;a href="/cwdc/13-webgl/examples/three/content/stl.html?controls=trackball&amp;file=Spitfire/scene.glb">link (TrackballControls)&lt;/a>
 * @see &lt;a href="/cwdc/13-webgl/examples/three/content/stl.js">source&lt;/a>
 * @see {@link https://www.adobe.com/creativecloud/file-types/image/vector/stl-file.html#what-is-an-stl-file STL files}
 * @see {@link https://docs.fileformat.com/3d/mtl/ What is an MTL file?}
 * @see {@link https://www.donmccurdy.com/ Contact} (He's the man)
 * @see {@link https://free3d.com Free3D}
 * @see {@link https://sketchfab.com/feed Sketchfab}
 * @see {@link https://www.body3d.eu/3D/Navigation/ body3d}
 * @see {@link https://www.zygotebody.com Zygote Body}
 * @see {@link https://threejs.org/examples/ threejs examples}
 * @see &lt;figure>
 *     &lt;iframe title="Soldier" src="/cwdc/13-webgl/examples/three/content/stl.html?file=Soldier.glb" style="position: relative; right: 40px; margin-bottom: 0px; transform: scale(0.85); width: 380px; height: 380px">&lt;/iframe>
 *     &lt;figcaption style="font-size: 150%">Model by {@link https://www.mixamo.com/#/ Mixamo}&lt;/figcaption>
 *     &lt;/figure>
 * @see &lt;figure>
 *     &lt;iframe title="Soldier" src="/cwdc/13-webgl/examples/three/content/stl.html?file=Skeleton/model.gltf" style="position: relative; right: 40px; margin-bottom: 0px; transform: scale(0.85); width: 380px; height: 380px">&lt;/iframe>
 *     &lt;figcaption style="font-size: 150%">Model by {@link https://discourse.threejs.org/u/neofelis/summary Neofelis}&lt;/figcaption>
 *     &lt;/figure>
 */

"use strict";

import * as THREE from "three";
import { STLLoader } from "three/addons/loaders/STLLoader.js";
import { VTKLoader } from "three/addons/loaders/VTKLoader.js";
import { OBJLoader } from "three/addons/loaders/OBJLoader.js";
import { MTLLoader } from "./MTLLoader.js";
import { GLTFLoader } from "three/addons/loaders/GLTFLoader.js";
import { DRACOLoader } from "three/addons/loaders/DRACOLoader.js";
import { KTX2Loader } from "three/addons/loaders/KTX2Loader.js";
import { MeshoptDecoder } from "three/addons/libs/meshopt_decoder.module.js";
import { RoomEnvironment } from "three/addons/environments/RoomEnvironment.js";
import { ArcballControls } from "three/addons/controls/ArcballControls.js";
import { OrbitControls } from "three/addons/controls/OrbitControls.js";
import { TrackballControls } from "three/addons/controls/TrackballControls.js";
import Stats from "three/addons/libs/stats.module.js";
import * as BufferGeometryUtils from "three/addons/utils/BufferGeometryUtils.js";
import { RGBELoader } from "three/addons/loaders/RGBELoader.js";
import { EXRLoader } from "three/addons/loaders/EXRLoader.js";
import { MeshEdgesGeometry } from "./MeshEdgesGeometry.js";

const drpath = "https://unpkg.com/three@latest/examples/jsm/libs/draco/gltf/";
const ktpath = "https://unpkg.com/three@latest/examples/jsm/libs/basis/";

/**
 * ArcballControls zoom and pan do not work on mobile devices.
 * @type {Boolean}
 */
const mobile =
  Math.min(window.screen.width, window.screen.height) &lt; 768 ||
  navigator.userAgent.indexOf("Mobi") > -1;

/**
 * Enum for types of {@link https://threejs.org/docs/#api/en/extras/Controls controls}.
 * @readonly
 * @enum {number}
 */
const ctype = Object.freeze({
  ARCBALL: 0,
  ORBIT: 1,
  TRACKBALL: 2,
});

/**
 * &lt;p>Define an orthographic view type.&lt;/p>
 * The interpolate property is used to interpolate from the current orientation
 * to the front, top, and side views.
 * @type {Boolean}
 */
const orthoView = {
  front: false,
  top: false,
  side: false,
  interpolate: false,
};

/**
 * &lt;p>Camera position for the three axes.&lt;/p>
 * @type {Object&lt;String, THREE.Vector3>}
 * @global
 */
const cameraPos = {
  value: 0,
  x: new THREE.Vector3(),
  y: new THREE.Vector3(),
  z: new THREE.Vector3(),

  /**
   * Set the camera position for the three axes.
   * THREE.Vector3(1.2*diag, 0, 0) for the x-axis,
   * THREE.Vector3(0, 1.2*diag, 0) for the y-axis,
   * and THREE.Vector3(0, 0, 1.2*diag) for the z-axis.
   * @param {Number} d length of the bounding box diagonal.
   */
  set diag(d) {
    this.value = d;
    this.x.x = 1.2 * d;
    this.y.y = 1.2 * d;
    this.z.z = 1.2 * d;
  },

  /**
   * Get the length of the bounding box diagonal.
   */
  get diag() {
    return this.value;
  },
};

/**
 * {@link THREE.ArcballControls ArcballControls} x
 * {@link THREE.OrbitControls OrbitControls} x
 * {@link THREE.TrackballControls TrackballControls}
 * @type {Number}
 */

let ctrlType = mobile ? ctype.ORBIT : ctype.ARCBALL;
/**
 * Maps a model to its environment.
 * @type {Object&lt;String,THREE.DataTexture>}
 * @global
 */
const environment = {};

/**
 * Maps models to their environments given in the form of either
 * {@link https://www.lifewire.com/hdr-file-2621550 HDR} or
 * {@link https://massive.io/file-transfer/what-is-an-exr-file/ EXR} images.
 * @type {Object&lt;String,String>}
 */
const fnames = {
  Helmet: "san_giuseppe_bridge_2k.hdr",
  Falcon: "spot1Lux.hdr",
  Spitfire: "blouberg_sunrise_2_1k.hdr",
  enterprise: mobile ? "starmap_2020_2k.exr" : "starmap_2020_4k.exr",
};

/**
 * &lt;p>Load textures (before any model), then call {@link init}.&lt;/p>
 * To be sure everything has been loaded, one can either use
 * a series of nested load calls or, as
 * &lt;a href="/cwdc/3-javascript/doc-promises/">I do&lt;/a>, simply use
 * {@link https://threejs.org/docs/#api/en/loaders/Loader.loadAsync loadAsync}
 * to avoid the so-called {@link http://callbackhell.com/ callback hell}.
 * @param {String} dfile initial model name.
 * @see {@link https://medium.com/@yuantiffanyzhang/6-solutions-for-taming-nested-callbacks-in-javascript-8a2a13d72085 6 Solutions for Taming Nested Callbacks in JavaScript}
 * @see &lt;a href="/cwdc/3-javascript/doc-promises2/">Promises&lt;/a>
 * @see {@link https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/all Promise.all()}
 */
function loadTextures(dfile) {
  /**
   * Creates a texture directly from raw data, width and height.
   * @class DataTexture
   * @memberof THREE
   * @see {@link https://threejs.org/docs/#api/en/textures/DataTexture DataTexture}
   */

  /**
   * {@link https://en.wikipedia.org/wiki/High_dynamic_range HDR} image loader
   * for creating environment maps.
   * @class RGBELoader
   * @memberof THREE
   * @see {@link https://threejs.org/docs/#api/en/loaders/DataTextureLoader DataTextureLoader}
   * @see {@link https://www.adobe.com/creativecloud/photography/discover/hdr.html What is HDR?}
   */
  const rgbe_loader = new RGBELoader().setPath("textures/equirectangular/");

  /**
   * {@link https://en.wikipedia.org/wiki/OpenEXR EXR} texture loader
   * for creating environments.
   * @class EXRLoader
   * @memberof THREE
   * @see {@link https://threejs.org/docs/#api/en/loaders/DataTextureLoader DataTextureLoader}
   * @see {@link https://massive.io/file-transfer/what-is-an-exr-file/ What is an EXR File?}
   */
  const exr_loader = new EXRLoader().setPath("textures/");

  const promises = [];
  for (const f of Object.keys(fnames)) {
    const loader = fnames[f].includes(".exr") ? exr_loader : rgbe_loader;
    promises.push(
      loader.loadAsync(fnames[f]).then((hdrEquirect) => {
        hdrEquirect.mapping = THREE.EquirectangularReflectionMapping;
        environment[f] = hdrEquirect;
        console.log(`loaded: ${f}`);
        return f;
      }),
    );
  }
  // wait for all promises to be fulfilled or any of them to be rejected
  Promise.all(promises)
    .then((results) => {
      console.log("All done", results);
      init(dfile);
    })
    .catch((error) => {
      console.error(
        `${error.name}: loadTextures (enterprise)\n${error.message}`,
      );
      // EXR is the slowest promise
      // don't return anything → execution goes the normal way
    });
}

/**
 * An Async alternative to {@link loadTextures}.
 * @param {String} dfile initial model name.
 * @see {@link https://codedamn.com/news/javascript/javascript-async-await-error Mastering Async Await Error Handling}
 */
async function loadTexturesAsync(dfile) {
  const rgbe_loader = new RGBELoader().setPath("textures/equirectangular/");
  const exr_loader = new EXRLoader().setPath("textures/");

  for (const f of Object.keys(fnames)) {
    const loader = fnames[f].includes(".exr") ? exr_loader : rgbe_loader;
    try {
      const hdrEquirect = await loader.loadAsync(fnames[f]);
      hdrEquirect.mapping = THREE.EquirectangularReflectionMapping;
      environment[f] = hdrEquirect;
    } catch (error) {
      console.error(
        `${error.name}: loadTexturesAsync (${fnames[f]})\n${error.message}`,
      );
    }
  }
  init(dfile);
}

/**
 * Three.js module.
 * @external three
 * @author Ricardo Cabello ({@link https://coopermrdoob.weebly.com/ Mr.doob})
 * @since 24/04/2010
 * @license Licensed under the {@link https://www.opensource.org/licenses/mit-license.php MIT license}
 * @see {@link https://threejs.org/docs/#manual/en/introduction/Installation Installation}
 * @see {@link https://discoverthreejs.com DISCOVER three.js}
 * @see {@link https://riptutorial.com/ebook/three-js Learning three.js}
 * @see {@link https://github.com/mrdoob/three.js github}
 * @see {@link http://cindyhwang.github.io/interactive-design/Mrdoob/index.html An interview with Mr.doob}
 * @see {@link https://experiments.withgoogle.com/search?q=Mr.doob Experiments with Google}
 */

/**
 * &lt;p>Main three.js namespace.&lt;/p>
 * &lt;a href="/cwdc/13-webgl/examples/three/content/doc-example/index.html">Imported&lt;/a> from {@link external:three three.module.js}
 *
 * @namespace THREE
 */

/**
 * &lt;p>A representation of mesh, line, or point geometry.&lt;/p>
 * Includes vertex positions, face indices, normals, colors, UVs,
 * and custom attributes within buffers, reducing the cost of
 * passing all this data to the GPU.
 * @class BufferGeometry
 * @memberof THREE
 * @see https://threejs.org/docs/#api/en/core/BufferGeometry
 */

/**
 * Loads the viewer and starts the {@link runAnimation animation}.
 * @param {String} dfile initial model name.
 */
function init(dfile) {
  const canvas = document.getElementById("canvasid");

  /**
   * Color names mapping.
   * @type {Object&lt;String:hexadecimal>}
   * @global
   */
  const colorTable = {
    gold: 0xffd700,
    antiqueWhite: 0xfaebd7,
    white: 0xffffff,
    grey: 0xfcfcfc,
  };

  // default model
  const defModel = document
    .getElementById("models")
    .querySelector("[selected]");

  /**
   * Array holding model file names to create models from.
   * @type {Array&lt;String>}
   * @global
   */
  const models = [defModel ? defModel.text : ""];

  /**
   * Selected model number.
   * @type {Number}
   * @global
   */
  let modelCnt = defModel ? +defModel.value : 0;

  /**
   * Loaded model name.
   * @type {String}
   * @global
   */
  let loadedModelName = "";

  /**
   * The AnimationMixer is a player for animations on a particular object in the scene.
   * When multiple objects in the scene are animated independently,
   * one AnimationMixer may be used for each object.
   * @class AnimationMixer
   * @memberof THREE
   * @see {@link https://threejs.org/docs/#api/en/animation/AnimationMixer Animation Mixer}
   */
  let mixer;

  /**
   * Helper object to graphically show the world-axis-aligned bounding box around an object.
   * The actual bounding box is handled with Box3, this is just a visual helper for debugging.
   * It can be automatically resized with the BoxHelper.update method when
   * the object it's created from is transformed.
   * Note that the object must have a BufferGeometry for this to work,
   * so it won't work with Sprites.
   * @class BoxHelper
   * @memberof THREE
   * @see {@link https://threejs.org/docs/#api/en/helpers/BoxHelper Box Helper}
   */
  let boxh = undefined;

  /**
   * An axis object to visualize the 3 axes in a simple way.
   * The X axis is red. The Y axis is green. The Z axis is blue.
   * @class AxesHelper
   * @memberof THREE
   * @see {@link https://threejs.org/docs/#api/en/helpers/AxesHelper Axes Helper}
   */
  let axesHelper = undefined;

  /**
   * Maps model names to URLs, which were read from a &lt;a href="../models/models.json">json file&lt;/a>.
   * @type {Object}
   * @global
   */
  let modelj = undefined;

  /**
   * Object for keeping track of time. This uses performance.now if it is available,
   * otherwise it reverts to the less accurate Date.now.
   * @class Clock
   * @memberof THREE
   * @see {@link https://threejs.org/docs/#api/en/core/Clock Clock}
   */
  const clock = new THREE.Clock();

  /**
   * Populate the given array with model file names from an
   * html &amp;lt;select&amp;gt; element
   * identified by "models" and appends to it the
   * extra models from
   * {@link modelj}.
   * @param {Array&lt;String>} optionNames array of model file names.
   * @global
   */
  function getModels(optionNames) {
    optionNames.length = 0;
    const selectElement = document.getElementById("models");
    [...selectElement.options].map((o) => optionNames.push(o.text));

    if (modelj) {
      modelj.menu.popup.menuitem.map((elem) => {
        optionNames.push(elem.title);
      });
    }
  }

  /**
   * Set model file names of an html &amp;lt;select&amp;gt; element identified by "models".
   * @param {Array&lt;String>} optionNames array of model file names.
   * @global
   */
  function setModels(optionNames) {
    const sel = document.getElementById("models");

    let options_str = "";

    optionNames.forEach((md, index) => {
      options_str += `&lt;option value="${index}">${md}&lt;/option>`;
    });

    sel.innerHTML = options_str;
  }

  /**
   * The WebGL renderer displays your beautifully crafted scenes using WebGL.
   * @class WebGLRenderer
   * @memberof THREE
   * @see https://threejs.org/docs/#api/en/renderers/WebGLRenderer
   */
  const renderer = new THREE.WebGLRenderer({
    canvas: canvas,
    antialias: true,
  });

  /**
   * Canvas aspect ratio.
   * @type {Number}
   * @global
   */
  let aspect;
  if (mobile) {
    aspect = canvas.clientWidth / canvas.clientHeight;
    renderer.setSize(canvas.clientWidth, canvas.clientHeight);
  } else {
    aspect = window.innerWidth / window.innerHeight;
    renderer.setSize(window.innerWidth, window.innerHeight);
  }
  renderer.setPixelRatio(window.devicePixelRatio);

  /**
   * Camera that uses perspective projection.
   * @class PerspectiveCamera
   * @memberof THREE
   * @see https://threejs.org/docs/#api/en/cameras/PerspectiveCamera
   */
  const camera = new THREE.PerspectiveCamera(45, aspect, 0.01, 1000);

  /**
   * &lt;p>Scenes allow you to set up what and where is to be rendered by three.js.&lt;/p>
   * This is where you place objects, lights and cameras.
   * @class Scene
   * @memberof THREE
   * @see https://threejs.org/docs/#api/en/scenes/Scene
   */
  const scene = new THREE.Scene();
  scene.add(camera);

  /**
   * Arcball controls allow the camera to be controlled by a virtual trackball
   * with full touch support and advanced navigation functionality.
   * Cursor/finger positions and movements are mapped over a virtual trackball surface
   * represented by a gizmo and mapped in intuitive and consistent camera movements.
   * Dragging cursor/fingers will cause camera to orbit around the center of the trackball
   * in a conservative way (returning to the starting point will make the camera
   * to return to its starting orientation).
   * @class ArcballControls
   * @memberof THREE
   * @see {@link https://threejs.org/docs/#examples/en/controls/ArcballControls ArcballControls}
   * @see &lt;a href="/cwdc/13-webgl/examples/three/content/misc_controls_arcball.html?gui=1">Cerberus&lt;/a>
   * @see &lt;a href="/cwdc/13-webgl/examples/three/content/misc_controls_arcball.html">Cerberus (no Gui)&lt;/a>
   * @see &lt;a href="/cwdc/13-webgl/examples/three/content/misc_controls_arcball.js">source&lt;/a>
   * @see &lt;a href="/cwdc/13-webgl/showCode.php?f=examples/three/content/misc_controls_arcball">html&lt;/a>
   * @see &lt;figure>
   * &lt;img src="../textures/equirectangular/venice_sunset_1k.jpg" width="256">
   * &lt;figcaption>Venice Sunset {@link https://en.wikipedia.org/wiki/High_dynamic_range Hdr} image&lt;/figcaption>
   * @see &lt;/figure>
   */

  /**
   * Orbit controls allow the camera to orbit around a target.
   * To use this, as with all files in the /examples directory,
   * you will have to include the file separately in your HTML.
   * @class OrbitControls
   * @memberof THREE
   * @see {@link https://threejs.org/docs/#examples/en/controls/OrbitControls OrbitControls}
   */

  /**
   * &lt;p>TrackballControls is similar to OrbitControls.&lt;/p>
   * However, it does not maintain a constant camera up vector.
   * That means if the camera orbits over the “north” and “south” poles,
   * it does not flip to stay "right side up".
   * @class TrackballControls
   * @memberof THREE
   * @see https://threejs.org/docs/#examples/en/controls/TrackballControls
   */
  const controls =
    ctrlType == ctype.ARCBALL
      ? new ArcballControls(camera, canvas, scene)
      : ctrlType == ctype.ORBIT
        ? new OrbitControls(camera, canvas)
        : new TrackballControls(camera, canvas);
  controls.maxDistance = 3000;
  controls.minDistance = 0;
  if (ctrlType === ctype.TRACKBALL) {
    controls.rotateSpeed = 5.0;
    controls.zoomSpeed = 5;
    controls.panSpeed = 2;
    controls.noZoom = false;
    controls.noPan = false;
    controls.staticMoving = true;
    controls.dynamicDampingFactor = 0.3;
    controls.handleResize();
  } else {
    controls.enableRotate = true;
    controls.enableZoom = true;
    controls.enablePan = true;
    controls.cursorZoom = true;
    if (ctrlType === ctype.ARCBALL) {
      controls.dampingFactor = 5;
      controls.wMax = 10;
      controls.rotateSpeed = 1.0;
      controls.scaleFactor = 1.1;
      controls.adjustNearFar = true;
      controls.setGizmosVisible(false);
    } else if (ctrlType === ctype.ORBIT) {
      controls.enableDamping = true;
      controls.autoRotateSpeed = 5.0;
      controls.dampingFactor = 0.1;
      controls.autoRotate = false;
    }
  }

  // light
  const ambLight = new THREE.AmbientLight(colorTable.white, 3);

  const dirLight = new THREE.DirectionalLight(colorTable.white, 1.5);
  dirLight.position.set(200, 200, 1000);
  camera.add(dirLight.target);

  const mat = {};

  /**
   * &lt;p>A material for non-shiny surfaces, without specular highlights.&lt;/p>
   *
   * The material uses a non-physically based Lambertian model for calculating reflectance.
   * This can simulate some surfaces (such as untreated wood or stone) well,
   * but cannot simulate shiny surfaces with specular highlights (such as varnished wood).
   *
   * &lt;p>MeshLambertMaterial uses per-fragment shading.&lt;/p>
   *
   * @class MeshLambertMaterial
   * @memberof THREE
   * @see {@link https://threejs.org/docs/#api/en/materials/MeshLambertMaterial MeshLambertMaterial}
   */
  mat["d"] = new THREE.MeshLambertMaterial({
    color: colorTable.gold,
    reflectivity: 2,
    side: THREE.DoubleSide,
  });

  /**
   * &lt;p>A material for shiny surfaces with specular highlights.&lt;/p>
   *
   * The material uses a non-physically based Blinn-Phong model for calculating reflectance.
   * Unlike the Lambertian model used in the MeshLambertMaterial this can simulate
   * shiny surfaces with specular highlights (such as varnished wood).
   *
   * &lt;p>MeshPhongMaterial uses per-fragment shading.&lt;/p>
   *
   * @class MeshPhongMaterial
   * @memberof THREE
   * @see {@link https://threejs.org/docs/#api/en/materials/MeshPhongMaterial MeshPhongMaterial}
   */
  mat["p"] = new THREE.MeshPhongMaterial({
    color: colorTable.gold,
    shininess: 120,
    specular: colorTable.white,
    side: THREE.DoubleSide,
  });

  /**
   * &lt;p>A standard physically based material, using Metallic-Roughness workflow.&lt;p>
   *
   * &lt;p>Physically based rendering (PBR) has recently become the standard in many 3D applications.
   * This approach differs from older approaches in that instead of using approximations
   * The idea is that, instead of tweaking materials to look good under specific lighting,
   * material can be created that will react 'correctly' under all lighting scenarios.&lt;/p>
   *
   * In practice this gives a more accurate and realistic looking result
   * than the MeshLambertMaterial at the cost of being somewhat more computationally expensive.
   *
   * &lt;p>MeshStandardMaterial uses per-fragment shading.&lt;/p>
   * @class MeshStandardMaterial
   * @memberof THREE
   * @see {@link https://threejs.org/docs/#api/en/materials/MeshStandardMaterial MeshStandardMaterial}
   */
  mat["g"] = new THREE.MeshStandardMaterial({
    color: colorTable.gold,
    roughness: 0.3,
    metalness: 0.8,
    side: THREE.DoubleSide,
  });

  /**
   * An extension of the MeshStandardMaterial, providing more advanced
   * physically-based rendering properties:
   * &lt;ul>
   * &lt;li>Anisotropy: Ability to represent the anisotropic property of materials as observable
   * with brushed metals.&lt;/li>
   * &lt;li>Clearcoat: Some materials — like car paints, carbon fiber, and wet surfaces -
   *    require a clear, reflective layer on top of another layer that may be irregular or rough.
   *    Clearcoat approximates this effect, without the need for a separate transparent surface.&lt;/li>
   * &lt;li>Iridescence: Allows to render the effect where hue varies depending on
   *   the viewing angle and illumination angle.
   *   This can be seen on soap bubbles, oil films, or on the wings of many insects.&lt;/li>
   * &lt;li>Physically-based transparency: One limitation of .opacity is that
   *   highly transparent materials are less reflective. &lt;/li>
   * &lt;li>Physically-based .transmission provides a more realistic option for thin,
   *   transparent surfaces like glass.&lt;/li>
   * &lt;li>Advanced reflectivity: More flexible reflectivity for non-metallic materials.&lt;/li>
   * &lt;li>Sheen: Can be used for representing cloth and fabric materials.&lt;/li>
   * &lt;/ul>
   *
   * &lt;p>MeshPhysicalMaterial uses per-fragment shading.&lt;/p>
   * @class MeshPhysicalMaterial
   * @memberof THREE
   * @see {@link https://threejs.org/docs/#api/en/materials/MeshPhysicalMaterial MeshPhysicaldMaterial}
   * @see {@link https://www.youtube.com/watch?v=q63VhC3vYI0 Glass Objects with Physical Material}
   */
  mat["P"] = new THREE.MeshPhysicalMaterial({
    color: colorTable.white,
    transmission: 1.0,
    roughness: 0.0,
    ior: 1.7,
    thickness: 0.5,
    specularIntensity: 1.0,
    clearcoat: 1.0,
    side: THREE.DoubleSide,
  });

  /**
   * &lt;p>A material for drawing wireframe-style geometries.&lt;p>
   * @class LineBasicMaterial
   * @memberof THREE
   * @see {@link https://threejs.org/docs/#api/en/materials/LineBasicMaterial LineBasicMaterial}
   */
  const edgeMaterial = new THREE.LineBasicMaterial({
    color: colorTable.white,
    linewidth: 1,
  });

  /**
   * &lt;p>Materials describe the appearance of objects.&lt;/p>
   * They are defined in a (mostly) renderer-independent way,
   * so you don't have to rewrite materials if you decide to use a different renderer.
   * @class THREE.Material
   * @memberof THREE
   * @see {@link https://threejs.org/docs/#api/en/materials/Material Material}
   */

  /**
   * &lt;p>Current material for STL or VTK files.&lt;/p>
   * @type {THREE.Material}
   * @global
   */
  let material =
    mat[document.querySelector('input[name="material"]:checked').value];

  /**
   * &lt;p>Handles and keeps track of loaded and pending data.&lt;/p>
   * A default global instance of this class is created and used by loaders
   * if not supplied {@link https://threejs.org/docs/#api/en/loaders/managers/DefaultLoadingManager manually}.
   * &lt;p>The main reason for using this class is to be able to implement a
   * {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/progress progress bar}
   * as feedback to the user. Unfortunately, the manager reports the total number of files
   * loaded since its creation and not the number of files per model loaded.
   * Furthermore, this information passed along to
   * {@link https://threejs.org/docs/#api/en/loaders/managers/LoadingManager.onProgress onProress}
   * is not even trustworthy.
   * The best we can do is shadow the old image while the new one is being loaded.&lt;/p>
   * @class LoadingManager
   * @memberof THREE
   * @see {@link https://threejs.org/docs/#api/en/loaders/managers/LoadingManager Loading Manager}
   * @see &lt;img src="../Nefertiti.png" width="256">
   */
  const manager = new THREE.LoadingManager();
  const progressBar = document.getElementById("progress-bar");
  const progressBarLabel = document.getElementById("barLabel");
  const progressBarContainer = document.querySelector(
    ".progress-bar-container",
  );
  const percentage = (n, total) => Math.min(Math.round((n / total) * 100), 100);

  manager.onStart = (url, itemsLoaded, itemsTotal) => {
    progressBarContainer.style.display = "block";
    progressBar.value = percentage(itemsLoaded, itemsTotal);
    progressBarLabel.innerHTML = `Start loading ${itemsLoaded} in ${itemsTotal} ...`;
    console.log(
      `Started loading file: ${url} \nLoaded ${itemsLoaded} of ${itemsTotal} files.`,
    );
  };

  manager.onLoad = () => {
    progressBarContainer.style.display = "none";
    console.log("Loading Complete!");
  };

  manager.onProgress = (url, itemsLoaded, itemsTotal) => {
    progressBar.value = percentage(itemsLoaded, itemsTotal);
    progressBarLabel.innerHTML = `Loading ${itemsLoaded} in ${itemsTotal} ...`;
    console.log(
      `Loading file: ${url} \nLoaded ${itemsLoaded} of ${itemsTotal} files.`,
    );
  };

  manager.onError = (url) => {
    console.log(`There was an error loading ${url}`);
  };

  /**
   * The STL model format is widely used for rapid prototyping, 3D printing and computer-aided manufacturing.
   * @class STLLoader
   * @memberof THREE
   * @see {@link https://sbcode.net/threejs/loaders-stl/ STL Model Loader}
   * @see {@link https://blog.arashtad.com/blog/load-stl-3d-models-in-three-js/ How to load STL 3d models in Three JS}
   * @see {@link https://stl-viewer.dualbox.com/ Free STL Viewer}
   * @see {@link https://www.dualbox.com/apps/myminifactory-ranger/production miniature configurators}
   * @see {@link https://www.dualbox.com DualBox}
   */
  const stl_loader = new STLLoader(manager);

  /**
   * VTK data sets can contain several types of lattice data and/or geometric figures.
   * The content of VTK files can be in ASCII text format or a mixed binary/ASCII format
   * in which headers and parameters are in ASCII format but the data values are in binary format.
   * @class VTKLoader
   * @memberof THREE
   * @see {@link https://threejs.org/examples/webgl_loader_vtk.html VTK Model Loader}
   */
  const vtk_loader = new VTKLoader(manager);

  /**
   * &lt;p>A loader for loading a .obj resource.&lt;/p>
   * The OBJ file format is a simple data-format that represents 3D geometry in a
   * human readable format as the position of each vertex,
   * the UV position of each texture coordinate vertex, vertex normals,
   * and the faces that make each polygon defined as a list of vertices, and texture vertices.
   * @class OBJLoader
   * @memberof THREE
   * @see {@link https://threejs.org/docs/#examples/en/loaders/OBJLoader obj_loader Model Loader}
   * @see {@link https://imagetostl.com/convert/file/glb/to/obj Convert Your 3D Mesh/Model GLB Files to OBJ}
   */
  const obj_loader = new OBJLoader(manager);

  /**
   * &lt;p>A loader for loading an .mtl resource, used internally by OBJLoader.&lt;/p>
   * The Material Template Library format (MTL) or .MTL File Format is a
   * companion file format to .OBJ that describes surface shading (material)
   * properties of objects within one or more .OBJ files.
   * @class MTLLoader
   * @memberof THREE
   * @see {@link https://threejs.org/docs/#examples/en/loaders/MTLLoader mtl_loader Material Loader}
   * @see {@link https://paulbourke.net/dataformats/mtl/ MTL material format (Lightwave, OBJ)}
   * @see {@link https://people.sc.fsu.edu/~jburkardt/data/mtl/mtl.html Material Definitions for OBJ Files}
   * @see {@link https://en.wikipedia.org/wiki/Wavefront_.obj_file Wavefront .obj file}
   * @see {@link https://www.fileformat.info/format/material/ Alias/WaveFront Material (.mtl) File Format}
   */
  const mtl_loader = new MTLLoader(manager);

  /**
   * &lt;p>A loader for geometry compressed with the Draco library.&lt;/p>
   * Draco is an open source library for compressing and decompressing 3D meshes and point clouds.
   * Compressed geometry can be significantly smaller, at the cost of additional decoding time on the client device.
   * @class DRACOLoader
   * @memberof THREE
   * @see {@link https://threejs.org/docs/#examples/en/loaders/DRACOLoader DRACO Loader}
   * @see {@link https://opensource.googleblog.com/2017/01/introducing-draco-compression-for-3d.html Google Open Source Blog}
   * @see {@link https://github.com/google/draco github}
   */
  const draco_loader = new DRACOLoader();
  draco_loader.setDecoderPath(drpath);

  /**
   * &lt;p>Loader for KTX 2.0 GPU Texture containers.&lt;/p>
   * KTX 2.0 is a container format for various GPU texture formats.
   * The loader supports Basis Universal GPU textures, which can be quickly
   * transcoded to a wide variety of GPU texture compression formats.
   * While KTX 2.0 also allows other hardware-specific formats,
   * this loader does not yet parse them.
   * &lt;p>This loader parses the KTX 2.0 container and transcodes to a
   * supported GPU compressed texture format.
   * The required WASM transcoder and JS wrapper are available from
   * the examples/jsm/libs/basis directory.&lt;/p>
   * @class KTX2Loader
   * @memberof THREE
   * @see {@link https://threejs.org/docs/#examples/en/loaders/KTX2Loader KTX2 Loader}
   * @see {@link https://gdal.org/drivers/raster/ktx2.html GDAL KTX2}
   * @see {@link https://github.com/BinomialLLC/basis_universal github}
   * @see {@link https://threejs.org/examples/?q=gltf#webgl_loader_gltf_compressed GLTFLoader}
   */
  const ktx2Loader = new KTX2Loader()
    .setTranscoderPath(ktpath)
    .detectSupport(renderer);

  /**
   * &lt;p>A loader for glTF 2.0 resources.&lt;/p>
   glTF (GL Transmission Format) is an open format specification for efficient delivery and loading of 3D content.
   Assets may be provided either in JSON (.gltf) or binary (.glb) format. External files store textures (.jpg, .png)
   and additional binary data (.bin). A glTF asset may deliver one or more scenes,
   including meshes, materials, textures, skins, skeletons, morph targets, animations, lights, and/or cameras.
   * @class GLTFLoader
   * @memberof THREE
   * @see {@link https://threejs.org/docs/#examples/en/loaders/GLTFLoader GLTF Loader}
   * @see {@link https://gltf-viewer.donmccurdy.com glTF Viewer}
   * @see {@link https://github.khronos.org/glTF-Sample-Viewer-Release/ glTF Sample Viewer}
   * @see {@link https://github.com/KhronosGroup/glTF-Sample-Viewer github}
   * @see {@link https://github.khronos.org/glTF-Compressor-Release/ glTF Compressor}
   * @see {@link https://gltf.report gltf Report}
   * @see {@link https://gltf-transform.dev/ glTF Transform}
   */
  const gltfl_loader = new GLTFLoader(manager);
  gltfl_loader.setDRACOLoader(draco_loader);
  gltfl_loader.setKTX2Loader(ktx2Loader);
  gltfl_loader.setMeshoptDecoder(MeshoptDecoder);

  /**
   * This class generates a Prefiltered, Mipmapped Radiance Environment Map (PMREM)
   * from a cubeMap environment texture.
   * This allows different levels of blur to be quickly accessed based on material roughness.
   * Unlike a traditional mipmap chain, it only goes down to the LOD_MIN level (above),
   * and then creates extra even more filtered 'mips' at the same LOD_MIN resolution,
   * associated with higher roughness levels.
   * In this way we maintain resolution to smoothly interpolate diffuse lighting while
   * limiting sampling computation.
   * @class PMREMGenerator
   * @memberof THREE
   * @see {@link https://threejs.org/docs/#api/en/extras/PMREMGenerator PMREMGenerator}
   */
  const pmremGenerator = new THREE.PMREMGenerator(renderer);
  const background = new THREE.Color(colorTable.antiqueWhite);
  const roomEnvironment = pmremGenerator.fromScene(
    /**
     * This is an easy way of lighting a scene
     * by creating six light sources with different intensities using an "area light material".
     * @class RoomEnvironment
     * @extends {THREE.Scene}
     * @memberof THREE
     * @see {@link https://github.com/mrdoob/three.js/blob/master/examples/jsm/environments/RoomEnvironment.js RoomEnvironment}
     * @see {@link https://threejs.org/docs/#api/en/extras/PMREMGenerator.fromScene PMREMGenerator}
     * @see {@link https://threejs.org/examples/#misc_exporter_usdz USDZ exporter}
     */
    new RoomEnvironment(renderer),
    0.04,
  ).texture;
  //pmremGenerator.dispose();

  let lines = [];

  /**
   * &lt;p>The edges of the mesh of the current loaded object.&lt;/p>
   * @type {THREE.LineSegments}
   * @global
   */
  let line = undefined;

  /**
   * &lt;p>The mesh of the current loaded object for the formats vtk/stl.&lt;/p>
   * Every time a new object is loaded the previous one is disposed of.
   * @type {THREE.Mesh}
   * @global
   */
  let mesh = undefined;

  /**
   * &lt;p>The geometry of the current loaded object for the formats obj/gltf.&lt;/p>
   * Every time a new object is loaded the previous one is disposed of.
   * @type {THREE.Object3D}
   * @global
   */
  let object = undefined;

  /**
   * &lt;p>Class representing a 3D vector.&lt;/p>
   * A 3D vector is an ordered triplet of numbers (labeled x, y, and z),
   * which can be used to represent a number of things: a point, a direction, an ordered triplet of numbers.
   * @class Vector3
   * @memberof THREE
   * @see {@link https://threejs.org/docs/#api/en/math/Vector3 Vector3}
   */

  /**
   * &lt;p>Vector3 comparison must be based on distance:
   * if the distance between two Vector3 is less than some predefined value,
   * they are considered equal.&lt;/p>
   * @param {THREE.Vector3} v1 first vector.
   * @param {THREE.Vector3} v2 second vector.
   * @param {Number} epsilon tolerance.
   * @returns {Boolean} true if the distance between the two vectors is less than epsilon:
   *      Math.abs(v2.distanceTo(v1)) &lt; epsilon
   * @global
   */
  function isEqual(v1, v2, epsilon = Number.EPSILON) {
    return Math.abs(v2.distanceTo(v1)) &lt; epsilon;
  }

  /**
   * @summary Exponential Decay: THREE.MathUtils.lerp(position, target, 1 - Math.exp(-lambda * dt))
   * &lt;p>Linearly interpolate between the given position and a target,
   * where delta is the percent distance along the line:&lt;/p>
   * dt = 0 will be position and &lt;br>
   * dt = 1 will be target.
   * @param {THREE.Vector3} position current point.
   * @param {THREE.Vector3} target target point.
   * @param {Number} lambda a higher lambda value will make the movement more sudden,&lt;br>
   * and a lower value will make the movement more gradual.
   * @param {DOMHighResTimeStamp} dt delta time in seconds.
   * @return {THREE.Vector3} the new position.
   * @global
   * @see {@link https://www.rorydriscoll.com/2016/03/07/frame-rate-independent-damping-using-lerp/ Frame Rate Independent Damping using Lerp}
   * @see {@link https://threejs.org/docs/#api/en/math/MathUtils.damp damp()}
   * @see {@link https://threejs.org/docs/#api/en/math/Vector3.lerp lerp()}
   * @see {@link https://threejs.org/docs/#api/en/core/Clock.getDelta getDelta()}
   */
  function damp(position, target, lambda, dt) {
    position.set(
      THREE.MathUtils.damp(position.x, target.x, lambda, dt),
      THREE.MathUtils.damp(position.y, target.y, lambda, dt),
      THREE.MathUtils.damp(position.z, target.z, lambda, dt),
    );
    return position;
  }

  /**
   * &lt;p>Callback to load a model from a file to the scene.&lt;p>
   * The previous model loaded is
   * {@link https://threejs.org/docs/#manual/en/introduction/How-to-dispose-of-objects disposed}
   * of; that is, we try to release its geometry and material objects since they are no longer used.
   * {@link https://threejs.org/docs/#api/en/renderers/WebGLRenderTarget Render Targets}
   * allocate some resources needed by the shaders and should also be released.
   * @param {THREE.BufferGeometry} geometry model.
   * @global
   */
  function loadModel(geometry) {
    /**
     * &lt;p>Dispose material and its texture.&lt;/p>
     * TO BE FINISHED.
     * @param {THREE.Material} mat material.
     * @global
     * @see {@link https://discourse.threejs.org/t/when-to-dispose-how-to-completely-clean-up-a-three-js-scene/1549/24 When to dispose: How to completely clean up a Three.js scene}
     */
    function delMaterial(mat) {
      const texture_maps = [
        "map",
        "aoMap",
        "alphaMap",
        "bumpMap",
        "displacementMap",
        "envMap",
        "lightMap",
        "emissiveMap",
        "normalMap",
        "metalnessMap",
        "roughnessMap",
        "anisotropyMap",
        "clearcoatMap",
        "clearcoatNormalMap",
        "clearcoatRoughnessMap",
        "iridescenceMap",
        "iridescenceThicknessMap",
        "sheenColorMap",
        "sheenRoughnessMap",
        "specularMap",
        "specularColorMap",
        "specularIntensityMap",
        "thicknessMap",
        "transmissionMap",
      ];
      if (mat) {
        texture_maps.forEach((tex_map) => {
          if (mat[tex_map]) {
            mat[tex_map].dispose();
          }
        });
        mat.dispose();
      }
    }
    /**
     * Create a box and axes helpers for the object.
     * @param {THREE.Object3D} object a three.js object.
     * @global
     */
    function createBoxHelper(object) {
      if (boxh) {
        scene.remove(boxh);
        boxh.dispose();
        scene.remove(axesHelper);
        axesHelper.dispose();
      }
      boxh = new THREE.BoxHelper(object, 0xa52a2a);
      axesHelper = new THREE.AxesHelper(cameraPos.diag / 2);
      scene.add(axesHelper);
      scene.add(boxh);
      boxh.visible = document.getElementById("stats").checked;
      axesHelper.visible = document.getElementById("stats").checked;
    }

    mixer = undefined;

    // console.log(geometry);
    let vis = undefined;
    if (mesh) {
      scene.remove(mesh);
      mesh.geometry.dispose();
      mesh = undefined;
    }
    if (line) {
      scene.remove(line);
      line.geometry.dispose();
      vis = line.visible;
      line = undefined;
    }
    if (lines.length > 0) {
      for (const line of lines) {
        scene.remove(line);
        line.geometry.dispose();
      }
      vis = lines[0].visible;
      lines = [];
    }
    if (object) {
      scene.remove(object);
      object.traverse(function (child) {
        if (child.isMesh) {
          child.geometry.dispose();
          if (Array.isArray(child.material)) {
            child.material.forEach((material) => {
              delMaterial(material);
            });
          } else {
            delMaterial(child.material);
          }
        }
      });
      object = undefined;
      scene.remove(ambLight);
    }
    camera.remove(dirLight);
    scene.background = background;
    scene.environment = roomEnvironment;

    if (geometry.isBufferGeometry) {
      // stl, vtk
      if (
        !geometry.index &amp;&amp;
        ["Utah_teapot_(solid).stl", "Skull.stl", "colored.stl"].some((str) =>
          loadedModelName.includes(str),
        )
      ) {
        geometry.deleteAttribute("normal");
        geometry = BufferGeometryUtils.mergeVertices(geometry, 1e-4);
      }
      if (!geometry.getAttribute("normal")) {
        geometry.computeVertexNormals();
      }
      geometry.center();
      geometry.computeBoundingBox();
      cameraPos.diag = geometry.boundingBox.max.distanceTo(
        geometry.boundingBox.min,
      );

      mesh = new THREE.Mesh(geometry, material);
      mesh.position.set(0, 0, 0);
      createBoxHelper(mesh);

      scene.add(mesh);

      const edges = new THREE.EdgesGeometry(geometry);
      line = new THREE.LineSegments(edges, edgeMaterial);
      scene.add(line);
      camera.add(dirLight);
      line.visible = vis ? vis : false;
    } else if (geometry.scene) {
      // gltf file
      const model = geometry.scene;
      const bb = new THREE.Box3().setFromObject(model);
      cameraPos.diag = bb.max.distanceTo(bb.min);
      const center = new THREE.Vector3();
      bb.getCenter(center);

      if (["Nefertiti", "Lieu"].some((str) => loadedModelName.includes(str))) {
        model.traverse(function (child) {
          if (child.isMesh) {
            if (geometry.asset.generator.includes("MOPS CLI")) {
              // Nefertiti.glb - what a hack!!
              child.material.normalMapType = THREE.ObjectSpaceNormalMap;
              child.geometry.deleteAttribute("normal");
            }
            child.material.side = THREE.DoubleSide;
          }
        });
      }

      model.position.set(...center.negate().toArray());
      createBoxHelper(model);

      try {
        line = new THREE.LineSegments(
          new MeshEdgesGeometry(model),
          edgeMaterial,
        );
      } catch (error) {
        console.error(error);
        return;
      }
      line.visible = vis ? vis : false;

      const value = Object.keys(environment).find((str) =>
        loadedModelName.includes(str),
      );
      if (value) {
        scene.environment = environment[value];
        scene.background = environment[value];
      }
      scene.add(line);
      scene.add(model);

      if (
        !["Supermarine Spitfire", "Battle Damaged Sci-fi Helmet"].some(
          (str) => str === geometry.asset?.extras?.title,
        ) &amp;&amp;
        !["model.gl", "Brain", "Lungs", "Uro", "city", "RPE"].some((str) =>
          loadedModelName.includes(str),
        )
      ) {
        scene.add(ambLight);
      }
      object = model;
      if (geometry.animations[0]) {
        mixer = new THREE.AnimationMixer(model);

        if (geometry.animations[3]) {
          // Soldier.glb
          mixer
            .clipAction(geometry.animations[0])
            .setEffectiveWeight(0.0)
            .play();
          mixer
            .clipAction(geometry.animations[3])
            .setEffectiveWeight(1.0)
            .play();
          mixer
            .clipAction(geometry.animations[1])
            .setEffectiveWeight(0.0)
            .play();
        } else {
          mixer.clipAction(geometry.animations[0]).play();
        }
      }
    } else {
      // OBJ file
      const bb = new THREE.Box3().setFromObject(geometry);
      cameraPos.diag = bb.max.distanceTo(bb.min);
      const center = new THREE.Vector3();
      bb.getCenter(center);

      geometry.position.set(...center.negate().toArray());
      createBoxHelper(geometry);

      try {
        line = new THREE.LineSegments(
          new MeshEdgesGeometry(geometry),
          edgeMaterial,
        );
      } catch (error) {
        console.error(error);
        return;
      }
      line.visible = vis ? vis : false;
      scene.add(line);
      scene.add(geometry);
      if (
        [
          "male02.mtl",
          "female02.mtl",
          "littlesttokyo.mtl",
          "Cerberus.mtl",
          "windmill.mtl",
        ].some((str) => str === geometry.materialLibraries[0])
      ) {
        scene.add(ambLight);
      }
      if (geometry.materialLibraries[0].includes("Dog")) {
        const mesh = geometry.children.find((element) =>
          element.name.includes("Final"),
        );
        if (mesh) mesh.material.shininess = 0.0;
      }
      camera.add(dirLight);
      object = geometry;
    }
    handleKeyPress(createEvent("o"));
    const { geometries, textures } = renderer.info.memory;
    document.getElementById("info").innerHTML =
      `programs:${renderer.info.programs.length}, geometries:${geometries}, textures:${textures}`;
  }

  /**
   * &lt;p>When developing a Three.js application,
   * it is useful to understand how the performance changes as the code is developed.&lt;/p>
   * To achieve this purpose, a statistics panel can be added to the HTML document that outlines several properties,
   * such as the frames per second and how long a section of code takes to execute.
   * @class Stats
   * @memberof THREE
   * @see {@link https://sbcode.net/threejs/stats-panel/ Stats Panel}
   * @see {@link https://www.tutorialspoint.com/threejs/threejs_stats.htm Three.js - Stats}
   */
  const stats = new Stats();
  stats.domElement.style.position = "absolute";
  stats.domElement.style.left = "10px";
  stats.domElement.style.top = "10px";
  document.body.appendChild(stats.dom);
  stats.dom.style.display = "none";

  /**
   * &lt;p>A built in function that can be used instead of
   * {@link https://developer.mozilla.org/en-US/docs/Web/API/window/requestAnimationFrame requestAnimationFrame}.&lt;/p>
   * The {@link https://threejs.org/docs/#api/en/renderers/WebGLRenderer.setAnimationLoop renderer.setAnimationLoop}
   * parameter is a {@link runAnimation callback}, which
   * will be called every available frame.&lt;br>
   * If null is passed, it will stop any already ongoing animation.
   * @param {function} loop callback.
   * @function
   * @name setAnimationLoop
   * @global
   */
  renderer.setAnimationLoop(() => {
    runAnimation();
  });

  /**
   * &lt;p>Animation loop.&lt;/p>
   * Updates {@link THREE.TrackballControls controls},
   * renders the {@link THREE.Scene scene} and updates {@link THREE.Stats statistics}.
   * @global
   */
  function runAnimation() {
    const delta = clock.getDelta();
    if (mixer) {
      mixer.update(delta);
      renderer.render(scene, camera);
    } else if (orthoView.interpolate) {
      const speed = 2;
      const target = cameraPos.x;
      if (!isEqual(camera.position, target, 1e-2)) {
        // I see no difference between lerp and damp
        // camera.position.lerp(target, speed * delta);
        damp(camera.position, target, speed, delta);
        camera.lookAt(target);
        camera.up.set(0, 1, 0);
        controls.update();
        renderer.render(scene, camera);
      } else {
        orthoView.interpolate = false;
      }
    }

    stats.update();
    if (controls.autoRotate || ctrlType === ctype.TRACKBALL) controls.update();
  }

  /**
   * &lt;p>Closure for keydown events.&lt;/p>
   * @function
   * @global
   * @return {key_event} callback for handling a keyboard event.
   */
  const handleKeyPress = (() => {
    const mod = (n, m) => ((n % m) + m) % m;
    const getFileExtension = (filename) => filename.split(".").pop();
    let visible = false;
    const modelPath = "models";
    const loader = {
      vtk: vtk_loader,
      obj: obj_loader,
      stl: stl_loader,
      glb: gltfl_loader,
      gltf: gltfl_loader,
    };

    /**
     * &lt;p>Handler for keydown events.&lt;/p>
     * Selects the next/previous {@link models model}
     * or turns {@link THREE.Stats stats} and mesh visible/invisible
     * when pressing keys ("n","N") or ("s","m"), respectively.&lt;br>
     * @param {KeyboardEvent} event keyboard event.
     * @callback key_event callback to handle a key pressed.
     */
    return (event) => {
      const ch = event.key;
      switch (ch) {
        case "n":
        case "N":
        case "k":
          if (ch == "k") {
            modelCnt = +document.getElementById("models").value;
          } else {
            const incr = ch == "n" ? 1 : -1;
            modelCnt = mod(modelCnt + incr, models.length);
            document.getElementById("models").value = modelCnt;
          }

          // search models that came from the json file
          const md = modelj.menu.popup.menuitem.find(
            ({ title }) => title === models[modelCnt],
          );
          const model = md ? encodeURI(md.url) : models[modelCnt];

          let ext = getFileExtension(model);
          if (ext === "gltf") ext = "glb";
          const fileName = model.includes("https")
            ? model
            : `${modelPath}/${ext}/${model}`;
          loadedModelName = model;

          if (ext !== "obj") {
            loader[ext].load(fileName, loadModel);
          } else {
            if (model === "LittlestTokyo/LittlestTokyo.obj") {
              mtl_loader.setMaterialOptions({ side: THREE.FrontSide });
            } else {
              mtl_loader.setMaterialOptions({ side: THREE.DoubleSide });
            }
            const mtlName = fileName.replace(".obj", ".mtl");
            mtl_loader
              .loadAsync(mtlName)
              .then((materials) => {
                materials.preload();
                obj_loader.setMaterials(materials);
              })
              .catch((error) => {
                console.error(
                  `${error.name}: handleKeyPress (no "${mtlName}" found)\n${error.message}`,
                );
              })
              .finally(() => {
                obj_loader.load(fileName, loadModel);
              });
          }
          break;
        case "s":
          visible = !visible;
          if (visible) stats.dom.style.display = "block";
          else stats.dom.style.display = "none";
          document.getElementById("stats").checked = visible;
          if (ctrlType === ctype.ARCBALL) controls.setGizmosVisible(visible);
          boxh.visible = visible;
          axesHelper.visible = visible;
          if (ctrlType === ctype.ORBIT) {
            controls.autoRotate = visible;
            orthoView.interpolate = false;
          }
          break;
        case "m":
          if (line) line.visible = !line.visible;
          if (lines.length > 0) {
            for (const line of lines) {
              line.visible = !line.visible;
            }
          }
          document.getElementById("mesh").checked = line.visible;
          break;
        case "o":
        case "f":
          controls.reset();
          orthoView.front = true;
          orthoView.side = false;
          orthoView.top = false;
          orthoView.interpolate = false;
          // 1.6 is enough, but don't forget the zoom out
          camera.far = cameraPos.diag * 5;
          camera.near = cameraPos.diag * 0.05;
          camera.position.set(cameraPos.z.x, cameraPos.z.y, cameraPos.z.z);
          camera.up.set(0, 1, 0);
          controls.maxDistance = camera.far;
          camera.updateProjectionMatrix();
          // ArcballControls bug!! (when camera.position==camera.target → nearPos0 &lt; 0)
          // this._nearPos0 = camera.position.distanceTo( this.target ) - camera.near;
          if (ctrlType === ctype.ARCBALL) controls.setCamera(camera);
          controls.update();
          break;
        case "d":
        case "g":
        case "p":
        case "P":
          material = mat[ch];
          document.getElementById(ch).checked = true;
          if (mesh) {
            mesh.material = material;
          }
          break;
        case "c":
          if (event.ctrlKey) controls.copyState();
          break;
        case "v":
          if (event.ctrlKey) controls.pasteState();
          break;
        case "t":
          orthoView.top = true;
          orthoView.side = false;
          orthoView.front = false;
          orthoView.interpolate = false;
          controls.reset();
          camera.position.set(cameraPos.y.x, cameraPos.y.y, cameraPos.y.z);
          if (ctrlType === ctype.ORBIT) {
            //controls.target.set(-1.0, 0.0, 0.0);
          } else {
            camera.up.set(-1, 0, 0);
          }
          controls.update();
          break;
        case "a":
          orthoView.side = true;
          orthoView.top = false;
          orthoView.front = false;
          orthoView.interpolate = false;
          controls.reset();
          camera.position.set(cameraPos.x.x, cameraPos.x.y, cameraPos.x.z);
          camera.up.set(0, 1, 0);
          controls.update();
          break;
        case "i":
          if (controls.autoRotate) handleKeyPress(createEvent("s"));
          orthoView.interpolate = true;
          break;
        default:
          return;
      }
      renderer.render(scene, camera);
    };
  })();

  /**
   * Returns a new keyboard event
   * that can be passed to {@link handleKeyPress}.
   * @param {String} key char code.
   * @param {Boolean} ctrl control key.
   * @fires keydown
   * @global
   */
  const createEvent = (key, ctrl = false) => {
    const code = key.charCodeAt();
    return new KeyboardEvent("keydown", {
      key: key,
      which: code,
      charCode: code,
      keyCode: code,
      ctrlKey: ctrl,
    });
  };

  /**
   * &lt;p>Fires when the document view (window) has been resized.&lt;/p>
   * Also resizes the canvas and viewport.
   * @callback handleWindowResize
   * @see {@link https://developer.mozilla.org/en-US/docs/Web/API/Window/resize_event Window: resize event}
   */
  function handleWindowResize() {
    let h = window.innerHeight - 20;
    let w = window.innerWidth - 20;
    const r = document.querySelector(":root");
    if (h > w) {
      h = w / aspect; // aspect &lt; 1
      camera.aspect = aspect;
    } else {
      //w = h * aspect; // aspect > 1
      camera.aspect = w / h;
    }
    camera.updateProjectionMatrix();
    renderer.setSize(w, h);
    renderer.render(scene, camera);
    r.style.setProperty("--canvasw", `${w}px`);
    r.style.setProperty("--canvash", `${h}px`);
  }

  /**
   * &lt;p>Fires when the document view (window) has been resized.&lt;/p>
   * &lt;p>The {@link handleWindowResize callback} argument sets the callback
   * that will be invoked when the event is dispatched.&lt;/p>
   * @summary Appends an event listener for events whose type attribute value is resize.
   * @param {Event} event a generic event.
   * @param {callback} function function to run when the event occurs.
   * @param {Boolean} useCapture handler is executed in the bubbling or capturing phase.
   * @event resize
   * @see {@link https://developer.mozilla.org/en-US/docs/Web/API/Window/resize_event Window: resize event}
   */
  window.addEventListener("resize", handleWindowResize, false);

  /**
   * &lt;p>Fired when a key is pressed.&lt;/p>
   * &lt;p>The {@link handleKeyPress callback} argument sets the callback that will be invoked when
   * the event is dispatched.&lt;/p>
   *
   * @summary Appends an event listener for events whose type attribute value is keydown.
   * @param {KeyboardEvent} event a UIEvent.
   * @param {callback} function function to run when the event occurs.
   * @event keydown
   * @see {@link https://developer.mozilla.org/en-US/docs/Web/API/Element/keydown_event Element: keydown event}
   */
  window.addEventListener("keydown", (event) => {
    handleKeyPress(event);
  });

  /**
   * &lt;p>Fired for models &amp;lt;select&amp;gt; element
   * when the user modifies its value. &lt;/p>
   * The {@link handleKeyPress callback} argument sets the callback that will be invoked when
   * the event is dispatched.&lt;/p>
   * @summary Appends an event listener for events whose type attribute value is change.
   * @param {Event} event a generic event.
   * @param {callback} function function to run when the event occurs.
   * @event modelsSelect
   * @see {@link https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/change_event HTMLElement: change event}
   */
  document.getElementById("models").addEventListener("change", (event) => {
    event.target.blur();
    handleKeyPress(createEvent("k"));
  });

  /**
   * &lt;p>Fired when the mesh  &amp;lt;input type="checkbox"&amp;gt; is checked or unchecked
   * (by clicking or using the keyboard).&lt;/p>
   * The {@link handleKeyPress callback} argument sets the callback that will be invoked when
   * the event is dispatched.&lt;/p>
   * @summary Appends an event listener for events whose type attribute value is change.
   * @param {Event} event a generic event.
   * @param {callback} function function to run when the event occurs.
   * @event meshChkBox
   * @see {@link https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/change_event HTMLElement: change event}
   */
  document
    .getElementById("mesh")
    .addEventListener("change", (event) => handleKeyPress(createEvent("m")));

  if (document.querySelector('input[name="material"]')) {
    document.querySelectorAll('input[name="material"]').forEach((elem) => {
      /**
       * &lt;p>Fired when the material &amp;lt;input type="radio"&amp;gt;
       * is checked (but not when unchecked).&lt;/p>
       * The {@link handleKeyPress callback} argument sets the callback that will be invoked when
       * the event is dispatched.&lt;/p>
       * @summary Appends an event listener for events whose type attribute value is change.
       * @param {Event} event a generic event.
       * @param {callback} function function to run when the event occurs.
       * @event materialRadio
       * @see {@link https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/change_event HTMLElement: change event}
       */
      elem.addEventListener("change", function (event) {
        const item = event.target.value;
        handleKeyPress(createEvent(item));
      });
    });
  }

  /**
   * &lt;p>Fired when the stats &amp;lt;input type="checkbox"&amp;gt; is checked or unchecked
   * (by clicking or using the keyboard).&lt;/p>
   * The {@link handleKeyPress callback} argument sets the callback that will be invoked when
   * the event is dispatched.&lt;/p>
   * @summary Appends an event listener for events whose type attribute value is change.
   * @param {Event} event a generic event.
   * @param {callback} function function to run when the event occurs.
   * @event statsChkBox
   * @see {@link https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/change_event HTMLElement: change event}
   */
  document
    .getElementById("stats")
    .addEventListener("change", (event) => handleKeyPress(createEvent("s")));

  /**
   * &lt;p>Fires after both the mousedown and
   * mouseup events have fired (in that order).&lt;/p>
   * Reset button must be pressed and released while the pointer is located inside it.
   * &lt;p>The {@link handleKeyPress callback} argument sets the callback that will be invoked when
   * the event is dispatched.&lt;/p>
   * @summary Appends an event listener for events whose type attribute value is click.
   * @event clickReset
   * @see {@link https://developer.mozilla.org/en-US/docs/Web/API/Element/click_event Element: click event}
   */
  document
    .getElementById("reset")
    .addEventListener("click", (event) => handleKeyPress(createEvent("i")));

  /**
   * &lt;p>Fires after both the mousedown and
   * mouseup events have fired (in that order).&lt;/p>
   * Top button must be pressed and released while the pointer is located inside it.
   * &lt;p>The {@link handleKeyPress callback} argument sets the callback that will be invoked when
   * the event is dispatched.&lt;/p>
   * @summary Appends an event listener for events whose type attribute value is click.
   * @event clickTop
   * @see {@link https://developer.mozilla.org/en-US/docs/Web/API/Element/click_event Element: click event}
   */
  document
    .getElementById("top")
    .addEventListener("click", (event) => handleKeyPress(createEvent("t")));

  /**
   * &lt;p>Fires after both the mousedown and
   * mouseup events have fired (in that order).&lt;/p>
   * Front button must be pressed and released while the pointer is located inside it.
   * &lt;p>The {@link handleKeyPress callback} argument sets the callback that will be invoked when
   * the event is dispatched.&lt;/p>
   * @summary Appends an event listener for events whose type attribute value is click.
   * @event clickFront
   * @see {@link https://developer.mozilla.org/en-US/docs/Web/API/Element/click_event Element: click event}
   */
  document
    .getElementById("front")
    .addEventListener("click", (event) => handleKeyPress(createEvent("f")));

  /**
   * &lt;p>Fires after both the mousedown and
   * mouseup events have fired (in that order).&lt;/p>
   * Side button must be pressed and released while the pointer is located inside it.
   * &lt;p>The {@link handleKeyPress callback} argument sets the callback that will be invoked when
   * the event is dispatched.&lt;/p>
   * @summary Appends an event listener for events whose type attribute value is click.
   * @event clickSide
   * @see {@link https://developer.mozilla.org/en-US/docs/Web/API/Element/click_event Element: click event}
   */
  document
    .getElementById("side")
    .addEventListener("click", (event) => handleKeyPress(createEvent("a")));

  /**
   * &lt;p>Fires when the camera has been transformed by the controls.&lt;/p>
   * The {@link https://threejs.org/docs/#api/en/renderers/WebGLRenderer.render callback}
   * argument sets the callback that will be invoked when
   * the event is dispatched.&lt;/p>
   * @summary Appends an event listener for events whose type attribute value is change.
   * @param {Event} event a generic event.
   * @param {callback} function function to run when the event occurs.
   * @event controls
   * @see {@link https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/change_event HTMLElement: change event}
   * @see {@link THREE.OrbitControls}
   * @see {@link THREE.ArcballControls}
   */
  controls.addEventListener("change", () => {
    renderer.render(scene, camera);
  });

  /**
   * &lt;p>Fired when the pointer is pressed on the canvas.&lt;/p>
   * The {@link orthoView.interpolate} is set to false,
   * so interpolation is interrupted as soon as the pointer is pressed.
   * &lt;p>Note that adding the event to the
   * {@link https://discourse.threejs.org/t/mouseup-problem-with-orbit-controls/64589 controls object}
   * does not work.&lt;/p>
   *
   * @event pointerdown
   */
  renderer.domElement.addEventListener("pointerdown", () => {
    orthoView.interpolate = false;
  });

  /**
   * Read the json file with the URLs for loading models.
   * @async
   * @global
   * @returns {Object} object for mapping model names to URLs.
   * @see {@link https://casual-effects.com/data/ Meshes}
   */
  async function loadModelj() {
    const response = await fetch("./models/models.json");
    return await response.json();
  }

  /**
   * &lt;p>Self-invoking anonymous function.&lt;/p>
   * &lt;ul>
   * &lt;li>Appends the models read from the json file to the &amp;lt;select&amp;gt; element.&lt;/li>
   * &lt;li>Sorts the list of models from the &amp;lt;select&amp;gt; element.&lt;/li>
   * &lt;li>Displays the default model.&lt;/li>
   * &lt;li>Resizes the window to occupy the maximum area of the device's viewport.&lt;/li>
   * &lt;/ul>
   * @global
   * @async
   * @function anonymous
   */
  (async () => {
    modelj = await loadModelj();

    const initialModel = models[0];
    getModels(models);
    models.sort();
    setModels(models);
    modelCnt = models.indexOf(dfile ? dfile : initialModel);
    document.getElementById("models").value = modelCnt;
    handleKeyPress(createEvent("k"));
    handleWindowResize();
  })();
}

/**
 * &lt;p>Fired when the whole page has loaded, including all dependent resources
 * such as stylesheets, scripts, iframes, and images, except those that are loaded lazily.&lt;/p>
 * @summary Sets the {@link init entry point} of the application.
 * @param {Event} event load event.
 * @callback WindowLoadCallback
 * @see {@link https://developer.mozilla.org/en-US/docs/Web/API/Window/load_event Window: load event}
 * @event load
 */
window.addEventListener("load", (event) => {
  const queryString = window.location.search;
  const urlParams = new URLSearchParams(queryString);
  const dfile = urlParams.get("file");
  const ctrls = urlParams.get("controls");
  const dtype = {
    arcball: ctype.ARCBALL,
    orbit: ctype.ORBIT,
    trackball: ctype.TRACKBALL,
  };

  if (ctrls) {
    ctrlType = dtype[ctrls] || ctype.ARCBALL;
  }
  loadTextures(dfile);
});
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-MeshEdgesGeometry.html">MeshEdgesGeometry</a></li></ul><h3>Externals</h3><ul><li><a href="external-three.html">three</a></li></ul><h3>Namespaces</h3><ul><li><a href="THREE.html">THREE</a></li></ul><h3>Classes</h3><ul><li><a href="THREE.AnimationMixer.html">AnimationMixer</a></li><li><a href="THREE.ArcballControls.html">ArcballControls</a></li><li><a href="THREE.AxesHelper.html">AxesHelper</a></li><li><a href="THREE.BoxHelper.html">BoxHelper</a></li><li><a href="THREE.BufferAttribute.html">BufferAttribute</a></li><li><a href="THREE.BufferGeometry.html">BufferGeometry</a></li><li><a href="THREE.Clock.html">Clock</a></li><li><a href="THREE.DRACOLoader.html">DRACOLoader</a></li><li><a href="THREE.DataTexture.html">DataTexture</a></li><li><a href="THREE.EXRLoader.html">EXRLoader</a></li><li><a href="THREE.GLTFLoader.html">GLTFLoader</a></li><li><a href="THREE.KTX2Loader.html">KTX2Loader</a></li><li><a href="THREE.LineBasicMaterial.html">LineBasicMaterial</a></li><li><a href="THREE.LoadingManager.html">LoadingManager</a></li><li><a href="THREE.MTLLoader.html">MTLLoader</a></li><li><a href="THREE.Material.html">Material</a></li><li><a href="THREE.MeshLambertMaterial.html">MeshLambertMaterial</a></li><li><a href="THREE.MeshPhongMaterial.html">MeshPhongMaterial</a></li><li><a href="THREE.MeshPhysicalMaterial.html">MeshPhysicalMaterial</a></li><li><a href="THREE.MeshStandardMaterial.html">MeshStandardMaterial</a></li><li><a href="THREE.OBJLoader.html">OBJLoader</a></li><li><a href="THREE.Object3D.html">Object3D</a></li><li><a href="THREE.OrbitControls.html">OrbitControls</a></li><li><a href="THREE.PMREMGenerator.html">PMREMGenerator</a></li><li><a href="THREE.PerspectiveCamera.html">PerspectiveCamera</a></li><li><a href="THREE.RGBELoader.html">RGBELoader</a></li><li><a href="THREE.RoomEnvironment.html">RoomEnvironment</a></li><li><a href="THREE.STLLoader.html">STLLoader</a></li><li><a href="THREE.Scene.html">Scene</a></li><li><a href="THREE.Stats.html">Stats</a></li><li><a href="THREE.TrackballControls.html">TrackballControls</a></li><li><a href="THREE.VTKLoader.html">VTKLoader</a></li><li><a href="THREE.Vector3.html">Vector3</a></li><li><a href="THREE.WebGLRenderer.html">WebGLRenderer</a></li><li><a href="module-MeshEdgesGeometry-MeshEdgesGeometry.html">MeshEdgesGeometry</a></li></ul><h3>Events</h3><ul><li><a href="global.html#event:clickFront">clickFront</a></li><li><a href="global.html#event:clickReset">clickReset</a></li><li><a href="global.html#event:clickSide">clickSide</a></li><li><a href="global.html#event:clickTop">clickTop</a></li><li><a href="global.html#event:controls">controls</a></li><li><a href="global.html#event:keydown">keydown</a></li><li><a href="global.html#event:load">load</a></li><li><a href="global.html#event:materialRadio">materialRadio</a></li><li><a href="global.html#event:meshChkBox">meshChkBox</a></li><li><a href="global.html#event:modelsSelect">modelsSelect</a></li><li><a href="global.html#event:pointerdown">pointerdown</a></li><li><a href="global.html#event:resize">resize</a></li><li><a href="global.html#event:statsChkBox">statsChkBox</a></li></ul><h3>Global</h3><ul><li><a href="global.html#anonymous">anonymous</a></li><li><a href="global.html#aspect">aspect</a></li><li><a href="global.html#cameraPos">cameraPos</a></li><li><a href="global.html#colorTable">colorTable</a></li><li><a href="global.html#createBoxHelper">createBoxHelper</a></li><li><a href="global.html#createEvent">createEvent</a></li><li><a href="global.html#ctrlType">ctrlType</a></li><li><a href="global.html#ctype">ctype</a></li><li><a href="global.html#damp">damp</a></li><li><a href="global.html#delMaterial">delMaterial</a></li><li><a href="global.html#environment">environment</a></li><li><a href="global.html#fnames">fnames</a></li><li><a href="global.html#getModels">getModels</a></li><li><a href="global.html#handleKeyPress">handleKeyPress</a></li><li><a href="global.html#init">init</a></li><li><a href="global.html#isEqual">isEqual</a></li><li><a href="global.html#line">line</a></li><li><a href="global.html#loadModel">loadModel</a></li><li><a href="global.html#loadModelj">loadModelj</a></li><li><a href="global.html#loadTextures">loadTextures</a></li><li><a href="global.html#loadTexturesAsync">loadTexturesAsync</a></li><li><a href="global.html#loadedModelName">loadedModelName</a></li><li><a href="global.html#material">material</a></li><li><a href="global.html#mesh">mesh</a></li><li><a href="global.html#mobile">mobile</a></li><li><a href="global.html#modelCnt">modelCnt</a></li><li><a href="global.html#modelj">modelj</a></li><li><a href="global.html#models">models</a></li><li><a href="global.html#object">object</a></li><li><a href="global.html#orthoView">orthoView</a></li><li><a href="global.html#runAnimation">runAnimation</a></li><li><a href="global.html#setAnimationLoop">setAnimationLoop</a></li><li><a href="global.html#setModels">setModels</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Fri Feb 07 2025 05:50:42 GMT-0300 (Brasilia Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
