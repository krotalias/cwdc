<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Class: CanvasDisplay</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Class: CanvasDisplay</h1>

    




<section>

<header>
    
        <h2><span class="attribs"><span class="type-signature"></span></span>
            <span class="ancestors"><a href="module-17_canvas.html">17_canvas</a>.</span>CanvasDisplay<span class="signature">(parent, level)</span><span class="type-signature"></span></h2>
        
            <div class="class-description"><p>This object keeps a little more information than <a href="module-16_game.DOMDisplay.html">DOMDisplay</a>.</p>
Rather than using the scroll position of its DOM element, it tracks its own <a href="module-17_canvas.CanvasDisplay.html#viewport">viewport</a>,
which tells us what part of the level we are currently looking at.
<p>Finally, it keeps a <a href="module-17_canvas.CanvasDisplay.html#flipPlayer">flipPlayer</a> property so that even when the player is standing still,
it keeps facing the direction it last moved in.</p>
<p>A word of caution: although the numerical values of the scale and sprites offset are the same,
they are different things. In order to change the global scale in the game, the offset information
was also saved in the <a href="module-17_canvas.html#~sprites">sprites</a> object.</p></div>
        
    
</header>

<article>
    <div class="container-overview">
    
        

    
    <h2>Constructor</h2>
    

    
    <h4 class="name" id="CanvasDisplay"><span class="type-signature"></span>new CanvasDisplay<span class="signature">(parent, level)</span><span class="type-signature"></span></h4>
    

    











    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>parent</code></td>
            

            <td class="type">
            
                
<span class="param-type">HTMLElement</span>


            
            </td>

            

            

            <td class="description last">parent element.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>level</code></td>
            

            <td class="type">
            
                
<span class="param-type">Level</span>


            
            </td>

            

            

            <td class="description last">geometry of the current level of the game.</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="code_chapter_17_canvas.js.html">code/chapter/17_canvas.js</a>, <a href="code_chapter_17_canvas.js.html#line84">line 84</a>
    </li></ul></dd>
    

    

    

    
</dl>




















    
    </div>

    

    

    

    

    

    

    
        <h3 class="subsection-title">Members</h3>

        
            
<h4 class="name" id="canvas"><span class="type-signature"></span>canvas<span class="type-signature"></span></h4>




<div class="description">
    Canvas object.
</div>







    <h5 class="subsection-title">Properties:</h5>

    

<table class="props">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>this</code></td>
            

            <td class="type">
            
                
<span class="param-type">Object</span>


            
            </td>

            

            

            <td class="description last">
                <h6>Properties</h6>

<table class="props">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>canvas</code></td>
            

            <td class="type">
            
                
<span class="param-type">HTMLCanvasElement</span>


            
            </td>

            

            

            <td class="description last">
                <h6>Properties</h6>

<table class="props">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>width</code></td>
            

            <td class="type">
            
                
<span class="param-type">Number</span>


            
            </td>

            

            

            <td class="description last"></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>height</code></td>
            

            <td class="type">
            
                
<span class="param-type">Number</span>


            
            </td>

            

            

            <td class="description last"></td>
        </tr>

    
    </tbody>
</table>

            </td>
        </tr>

    
    </tbody>
</table>

            </td>
        </tr>

    
    </tbody>
</table>




<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="code_chapter_17_canvas.js.html">code/chapter/17_canvas.js</a>, <a href="code_chapter_17_canvas.js.html#line98">line 98</a>
    </li></ul></dd>
    

    

    

    
</dl>






        
            
<h4 class="name" id="cx"><span class="type-signature"></span>cx<span class="type-signature"> :CanvasRenderingContext2D</span></h4>




<div class="description">
    2D rendering context for the drawing surface of a &lt;canvas&gt; element
</div>



    <h5>Type:</h5>
    <ul>
        <li>
            
<span class="param-type">CanvasRenderingContext2D</span>


        </li>
    </ul>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="code_chapter_17_canvas.js.html">code/chapter/17_canvas.js</a>, <a href="code_chapter_17_canvas.js.html#line108">line 108</a>
    </li></ul></dd>
    

    

    

    
</dl>






        
            
<h4 class="name" id="flipPlayer"><span class="type-signature"></span>flipPlayer<span class="type-signature"> :Boolean</span></h4>




<div class="description">
    Flip toggle, so player looks at the direction he has last moved in.
</div>



    <h5>Type:</h5>
    <ul>
        <li>
            
<span class="param-type">Boolean</span>


        </li>
    </ul>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="code_chapter_17_canvas.js.html">code/chapter/17_canvas.js</a>, <a href="code_chapter_17_canvas.js.html#line114">line 114</a>
    </li></ul></dd>
    

    

    

    
</dl>






        
            
<h4 class="name" id="viewport"><span class="type-signature"></span>viewport<span class="type-signature"></span></h4>




<div class="description">
    Viewport.
</div>







    <h5 class="subsection-title">Properties:</h5>

    

<table class="props">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>viewport</code></td>
            

            <td class="type">
            
                
<span class="param-type">Object</span>


            
            </td>

            

            

            <td class="description last">
                <h6>Properties</h6>

<table class="props">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>left</code></td>
            

            <td class="type">
            
                
<span class="param-type">Number</span>


            
            </td>

            

            

            <td class="description last">left corner horizontal position</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>top</code></td>
            

            <td class="type">
            
                
<span class="param-type">Number</span>


            
            </td>

            

            

            <td class="description last">left corner vertical position</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>width</code></td>
            

            <td class="type">
            
                
<span class="param-type">Number</span>


            
            </td>

            

            

            <td class="description last">width</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>height</code></td>
            

            <td class="type">
            
                
<span class="param-type">Number</span>


            
            </td>

            

            

            <td class="description last">height</td>
        </tr>

    
    </tbody>
</table>

            </td>
        </tr>

    
    </tbody>
</table>




<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="code_chapter_17_canvas.js.html">code/chapter/17_canvas.js</a>, <a href="code_chapter_17_canvas.js.html#line127">line 127</a>
    </li></ul></dd>
    

    

    

    
</dl>






        
    

    
        <h3 class="subsection-title">Methods</h3>

        
            

    

    
    <h4 class="name" id="clear"><span class="type-signature"></span>clear<span class="signature">()</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    Deletes this canvas.
</div>













<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="code_chapter_17_canvas.js.html">code/chapter/17_canvas.js</a>, <a href="code_chapter_17_canvas.js.html#line138">line 138</a>
    </li></ul></dd>
    

    

    

    
</dl>




















        
            

    

    
    <h4 class="name" id="clearDisplay"><span class="type-signature"></span>clearDisplay<span class="signature">(status)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    When clearing the display, we’ll use a slightly different color depending on
whether the game is won (brighter) or lost (darker).
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>status</code></td>
            

            <td class="type">
            
                
<span class="param-type">"won"</span>
|

<span class="param-type">"lost"</span>
|

<span class="param-type">"playing"</span>


            
            </td>

            

            

            <td class="description last">current condition of the game.</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="code_chapter_17_canvas.js.html">code/chapter/17_canvas.js</a>, <a href="code_chapter_17_canvas.js.html#line201">line 201</a>
    </li></ul></dd>
    

    

    

    
</dl>




















        
            

    

    
    <h4 class="name" id="drawActors"><span class="type-signature"></span>drawActors<span class="signature">(actors)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    <p>The drawPlayer method is called by drawActors, which is responsible for drawing all the actors in the game.</p>

When drawing something that is not the player, we look at its type to find the offset of the correct sprite. <br>
The lava tile is found at offset 20, and the coin sprite is found at 40 (two times scale). <br>

<p>We have to subtract the viewport’s position when computing the actor’s position,
since (0,0) on our canvas corresponds to the top left of the viewport, <br>
not the top left of the level. We could also have used translate for this. Either way works.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>actors</code></td>
            

            <td class="type">
            
                
<span class="param-type">Array.&lt;(Lava|Coin|Player)></span>


            
            </td>

            

            

            <td class="description last">actors of the game.</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="code_chapter_17_canvas.js.html">code/chapter/17_canvas.js</a>, <a href="code_chapter_17_canvas.js.html#line351">line 351</a>
    </li></ul></dd>
    

    

    

    
</dl>




















        
            

    

    
    <h4 class="name" id="drawBackground"><span class="type-signature"></span>drawBackground<span class="signature">(level)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    To draw the background, we run through the tiles that are visible in the current viewport,
using the same trick used in the touches method from the previous chapter.

<ul> <li>map: [left,right] → [0,this.canvas.width] or screenX = (x - left) / (right-left) * this.canvas.width </li>
<li> map: [top,bottom] → [0,this.canvas.height]    or screenY = (y - top)  / (top-bottom) * this.canvas.height </li>
<li> scale = this.canvas.width/width = this.canvas.height/height = 20</li></ul>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>level</code></td>
            

            <td class="type">
            
                
<span class="param-type">Level</span>


            
            </td>

            

            

            <td class="description last">geometry of the current level of the game.</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="code_chapter_17_canvas.js.html">code/chapter/17_canvas.js</a>, <a href="code_chapter_17_canvas.js.html#line222">line 222</a>
    </li></ul></dd>
    

    

    

    
</dl>




















        
            

    

    
    <h4 class="name" id="drawPlayer"><span class="type-signature"></span>drawPlayer<span class="signature">(player, x, y, width, height)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    <p>Tiles that are not empty are drawn with
<a href="https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/drawImage">drawImage</a>.
The other Sprites image contains the pictures used for elements other than the player.
It contains, from left to right, the wall tile, the lava tile, and the sprite for a coin.</p>
<p>Sprites for our game
Background tiles are 20 by 20 pixels, since we will use the same scale (20) that we used in DOMDisplay.
Thus, the offset for lava tiles is 20 (the value of the scale binding), and the offset for walls is 0. </p>

<p>We don’t bother waiting for the sprite image to load.
Calling drawImage with an image that hasn’t been loaded yet will simply do nothing.
Thus, we might fail to draw the game properly for the first few frames, while the image is still loading,
but that is not a serious problem.
Since we keep updating the screen, the correct scene will appear as soon as the loading finishes. </p>

<p>The walking character shown earlier will be used to represent the player.
The code that draws it needs to pick the right sprite and direction based on the player’s current motion.
The first eight sprites contain a walking animation. When the player is moving along a floor,
we cycle through them based on the current time.
We want to switch frames every 16.7 milliseconds (60 fps), so the time is divided by 60 first.
When the player is standing still, we draw the ninth sprite.
During jumps, which are recognized by the fact that the vertical speed is not zero, we use the tenth, rightmost sprite.</p>

<p>Because the sprites are slightly wider than the player object,
24 instead of 16 pixels to allow some space for feet and arms,
the method has to adjust the x-coordinate and width by a given amount (sprites.xOverlap).</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>player</code></td>
            

            <td class="type">
            
                
<span class="param-type">Player</span>


            
            </td>

            

            

            <td class="description last">player object.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>x</code></td>
            

            <td class="type">
            
                
<span class="param-type">Number</span>


            
            </td>

            

            

            <td class="description last">abscissa coordinate.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>y</code></td>
            

            <td class="type">
            
                
<span class="param-type">Number</span>


            
            </td>

            

            

            <td class="description last">ordinate coordinate.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>width</code></td>
            

            <td class="type">
            
                
<span class="param-type">Number</span>


            
            </td>

            

            

            <td class="description last">actor width times sprites.lavaOffset.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>height</code></td>
            

            <td class="type">
            
                
<span class="param-type">Number</span>


            
            </td>

            

            

            <td class="description last">actor height times sprites.lavaOffset.
<figure></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="code_chapter_17_canvas.js.html">code/chapter/17_canvas.js</a>, <a href="code_chapter_17_canvas.js.html#line306">line 306</a>
    </li></ul></dd>
    

    

    
    <dt class="tag-see">See:</dt>
    <dd class="tag-see">
        <ul>
            <li><img style="position: relative; right: 40px; margin-bottom: 0px;" src="../img/canvas_drawimage.jpg">
 <figcaption style="font-size: 100%"><a href="https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/drawImage">drawImage</a> parameters</figcaption>
</figure></li>
        </ul>
    </dd>
    

    
</dl>




















        
            

    

    
    <h4 class="name" id="syncState"><span class="type-signature"></span>syncState<span class="signature">(state)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    The syncState method first computes a new viewport and then draws the game scene at the appropriate position.
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>state</code></td>
            

            <td class="type">
            
                
<span class="param-type">State</span>


            
            </td>

            

            

            <td class="description last">state of a running game.</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="code_chapter_17_canvas.js.html">code/chapter/17_canvas.js</a>, <a href="code_chapter_17_canvas.js.html#line147">line 147</a>
    </li></ul></dd>
    

    

    

    
</dl>




















        
            

    

    
    <h4 class="name" id="updateViewport"><span class="type-signature"></span>updateViewport<span class="signature">(state)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    <p>The updateViewport method is similar to DOMDisplay’s
<a href="module-16_game.DOMDisplay.html#scrollPlayerIntoView">scrollPlayerIntoView</a> method.
It checks whether the player is too close to the edge of the screen and moves the viewport when this is the case.</p>

The canvas is divided into three parts, and a margin is defined as 1/3 of its width.
Whenever the player enters the third third, the viewport is translated
to the right, so the difference between the player position, and the right edge of the viewport,
is the margin (of course speed matters).

<p>If the player turns back, whenever the player enters the first third, the viewport is translated
to the left, so the difference between the player position and the left edge of the viewport, is the margin.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>state</code></td>
            

            <td class="type">
            
                
<span class="param-type">State</span>


            
            </td>

            

            

            <td class="description last">state of a running game.</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="code_chapter_17_canvas.js.html">code/chapter/17_canvas.js</a>, <a href="code_chapter_17_canvas.js.html#line169">line 169</a>
    </li></ul></dd>
    

    

    

    
</dl>




















        
    

    

    
</article>

</section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-16_game.html">16_game</a></li><li><a href="module-17_canvas.html">17_canvas</a></li><li><a href="module-levels.html">levels</a></li></ul><h3>Classes</h3><ul><li><a href="module-16_game.DOMDisplay.html">DOMDisplay</a></li><li><a href="module-16_game-Coin.html">Coin</a></li><li><a href="module-16_game-Lava.html">Lava</a></li><li><a href="module-16_game-Level.html">Level</a></li><li><a href="module-16_game-Player.html">Player</a></li><li><a href="module-16_game-State.html">State</a></li><li><a href="module-16_game-Vec.html">Vec</a></li><li><a href="module-17_canvas.CanvasDisplay.html">CanvasDisplay</a></li></ul><h3>Events</h3><ul><li><a href="module-16_game.html#~event:keydown">keydown</a></li><li><a href="module-16_game.html#~event:keyup">keyup</a></li><li><a href="global.html#event:load">load</a></li></ul><h3>Global</h3><ul><li><a href="global.html#displayDriver">displayDriver</a></li><li><a href="global.html#incLevel">incLevel</a></li><li><a href="global.html#mod">mod</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Tue Jan 07 2025 09:39:46 GMT-0300 (Brasilia Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>